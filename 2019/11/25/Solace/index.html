<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="Solace"/><link rel="alternate" href="/atom.xml" title="Lost in Wonderland"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0" />
<link rel="canonical" href="https://cwcwy.github.io/2019/11/25/Solace/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":"","latex":false};
</script>

    <title>Solace - Lost in Wonderland</title>
  <meta name="generator" content="Hexo 4.2.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Lost in Wonderland</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Lost in Wonderland</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            Tags
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            Categories
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            About
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">Solace
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-11-25
        </span></div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Intro"><span class="toc-text">Intro</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Concepts"><span class="toc-text">Concepts</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Event-amp-Msg"><span class="toc-text">Event &amp; Msg</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Message-Delivery-Model"><span class="toc-text">Message Delivery Model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Message-Models"><span class="toc-text">Message Models</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Message-VPN"><span class="toc-text">Message VPN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Endpoints"><span class="toc-text">Endpoints</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Getting-Started"><span class="toc-text">Getting Started</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-compose"><span class="toc-text">Docker-compose</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Demo-for-topic"><span class="toc-text">Demo for topic</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Topic-Publisher"><span class="toc-text">Topic Publisher:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Topic-Subscriber"><span class="toc-text">Topic Subscriber</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Demo-for-queue"><span class="toc-text">Demo for queue</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Queue-Producer"><span class="toc-text">Queue Producer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Queue-Consumer"><span class="toc-text">Queue Consumer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Demo-for-Topic-to-queue"><span class="toc-text">Demo for Topic to queue</span></a></li></ol></li></ol>
    </div>
  </div><div class="post-content"><h1 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h1><p>Solace is a PubSub+ software message broker.</p>
<h1 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h1><p>Here only necessary concepts are introduced. For advanced one, please refer to the <a href="https://docs.solace.com" target="_blank" rel="noopener">solace documentation</a>.</p>
<h2 id="Event-amp-Msg"><a href="#Event-amp-Msg" class="headerlink" title="Event &amp; Msg"></a>Event &amp; Msg</h2><ul>
<li>Event: pub/sub</li>
<li>Query: e.g. HTTP GET request point-to-point</li>
<li>Command: e.g. HTTP POST,PUT,DELETE request, point-to-point</li>
</ul>
<h2 id="Message-Delivery-Model"><a href="#Message-Delivery-Model" class="headerlink" title="Message Delivery Model"></a>Message Delivery Model</h2><table>
<thead>
<tr>
<th>Delivery Mode of Published Message</th>
<th>Received by Endpoint as…</th>
<th>Received by a Client with a Matching Topic Subscription as…</th>
</tr>
</thead>
<tbody><tr>
<td>Direct</td>
<td>Non-Persistent</td>
<td>Direct</td>
</tr>
<tr>
<td>Non-Persistent</td>
<td>Non-Persistent</td>
<td>Direct</td>
</tr>
<tr>
<td>Persistent</td>
<td>Persistent</td>
<td>Direct</td>
</tr>
</tbody></table>
<h2 id="Message-Models"><a href="#Message-Models" class="headerlink" title="Message Models"></a>Message Models</h2><ul>
<li>Point-to-Point: msg sent by <code>Producer</code> are to be processed by <code>a single consumer</code>.</li>
<li>Non-Exclusive Consumption: Extension from <code>P2P</code> model in addition of multiple consumers consuming from a shared channel or queue.</li>
<li>Publish-Subsribe: Msg sent by <code>Producer</code> are processed multiple times by <code>different consumers</code>.Each consumer receives its own copy of the message for processing.</li>
<li>Request-Reply: Two-way communication using separate <code>point-to-point</code> channels: one for requests, and another for replies.</li>
</ul>
<h2 id="Message-VPN"><a href="#Message-VPN" class="headerlink" title="Message VPN"></a>Message VPN</h2><p>Like <code>virtualenv</code>, it offers the segragation for different VPNs. In essence it enables virtualization of the event broker into many individual virtual event brokers.</p>
<h2 id="Endpoints"><a href="#Endpoints" class="headerlink" title="Endpoints"></a>Endpoints</h2><ul>
<li>Topic: publish/subsribe mode. A topic can be subscribed by many subsrbers.</li>
<li>Queue: procucer/consumer mode. A queue can be consumed by one consumer.</li>
</ul>
<h1 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h1><h2 id="Docker-compose"><a href="#Docker-compose" class="headerlink" title="Docker-compose"></a>Docker-compose</h2><p>Get from <a href="https://github.com/SolaceLabs/solace-single-docker-compose" target="_blank" rel="noopener">here</a></p>
<p>The <code>docker-compose up -d</code> command is used to start a solace event broker.</p>
<p>Solace PubSub+ Manager management access:</p>
<ol>
<li>Open a browser and enter this url: <a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a>.</li>
<li>Log in as user <code>admin</code> with default password <code>admin</code>.</li>
</ol>
<h2 id="Demo-for-topic"><a href="#Demo-for-topic" class="headerlink" title="Demo for topic"></a>Demo for topic</h2><p>The codes are from official demo: <a href="https://github.com/SolaceSamples/solace-samples-java" target="_blank" rel="noopener">https://github.com/SolaceSamples/solace-samples-java</a></p>
<h3 id="Topic-Publisher"><a href="#Topic-Publisher" class="headerlink" title="Topic Publisher:"></a>Topic Publisher:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.solace.samples;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.JCSMPException;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.JCSMPFactory;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.JCSMPProperties;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.JCSMPSession;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.JCSMPStreamingPublishEventHandler;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.TextMessage;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.Topic;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.XMLMessageProducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopicPublisher</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> <span class="keyword">throws</span> JCSMPException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check command line arguments</span></span><br><span class="line">        <span class="keyword">if</span> (args.length &lt; <span class="number">2</span> || args[<span class="number">1</span>].split(<span class="string">"@"</span>).length != <span class="number">2</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Usage: TopicPublisher &lt;host:port&gt; &lt;client-username@message-vpn&gt; [client-password]"</span>);</span><br><span class="line">            System.out.println();</span><br><span class="line">            System.exit(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">0</span>].isEmpty()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"No client-username entered"</span>);</span><br><span class="line">            System.out.println();</span><br><span class="line">            System.exit(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">1</span>].isEmpty()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"No message-vpn entered"</span>);</span><br><span class="line">            System.out.println();</span><br><span class="line">            System.exit(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"TopicPublisher initializing..."</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a JCSMP Session</span></span><br><span class="line">        <span class="keyword">final</span> JCSMPProperties properties = <span class="keyword">new</span> JCSMPProperties();</span><br><span class="line">        properties.setProperty(JCSMPProperties.HOST, args[<span class="number">0</span>]);     <span class="comment">// host:port</span></span><br><span class="line">        properties.setProperty(JCSMPProperties.USERNAME, args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">0</span>]); <span class="comment">// client-username</span></span><br><span class="line">        properties.setProperty(JCSMPProperties.VPN_NAME,  args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">1</span>]); <span class="comment">// message-vpn</span></span><br><span class="line">        <span class="keyword">if</span> (args.length &gt; <span class="number">2</span>) &#123; </span><br><span class="line">            properties.setProperty(JCSMPProperties.PASSWORD, args[<span class="number">2</span>]); <span class="comment">// client-password</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> JCSMPSession session =  JCSMPFactory.onlyInstance().createSession(properties);</span><br><span class="line"></span><br><span class="line">        session.connect();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Topic topic = JCSMPFactory.onlyInstance().createTopic(<span class="string">"tutorial/topic"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Anonymous inner-class for handling publishing events */</span></span><br><span class="line">        XMLMessageProducer prod = session.getMessageProducer(<span class="keyword">new</span> JCSMPStreamingPublishEventHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">responseReceived</span><span class="params">(String messageID)</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"Producer received response for msg: "</span> + messageID);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleError</span><span class="params">(String messageID, JCSMPException e, <span class="keyword">long</span> timestamp)</span> </span>&#123;</span><br><span class="line">                System.out.printf(<span class="string">"Producer received error for msg: %s@%s - %s%n"</span>,</span><br><span class="line">                        messageID,timestamp,e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// Publish-only session is now hooked up and running!</span></span><br><span class="line"></span><br><span class="line">        TextMessage msg = JCSMPFactory.onlyInstance().createMessage(TextMessage<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">final</span> String text = <span class="string">"Hello world!"</span>;</span><br><span class="line">        msg.setText(text);</span><br><span class="line">        System.out.printf(<span class="string">"Connected. About to send message '%s' to topic '%s'...%n"</span>,text,topic.getName());</span><br><span class="line">        prod.send(msg,topic);</span><br><span class="line">        System.out.println(<span class="string">"Message sent. Exiting."</span>);</span><br><span class="line">        session.closeSession();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Topic-Subscriber"><a href="#Topic-Subscriber" class="headerlink" title="Topic Subscriber"></a>Topic Subscriber</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopicSubscriber</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> <span class="keyword">throws</span> JCSMPException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check command line arguments</span></span><br><span class="line">        <span class="keyword">if</span> (args.length &lt; <span class="number">2</span> || args[<span class="number">1</span>].split(<span class="string">"@"</span>).length != <span class="number">2</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Usage: TopicSubscriber &lt;host:port&gt; &lt;client-username@message-vpn&gt; [client-password]"</span>);</span><br><span class="line">            System.out.println();</span><br><span class="line">            System.exit(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">0</span>].isEmpty()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"No client-username entered"</span>);</span><br><span class="line">            System.out.println();</span><br><span class="line">            System.exit(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">1</span>].isEmpty()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"No message-vpn entered"</span>);</span><br><span class="line">            System.out.println();</span><br><span class="line">            System.exit(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"TopicSubscriber initializing..."</span>);</span><br><span class="line">        <span class="keyword">final</span> JCSMPProperties properties = <span class="keyword">new</span> JCSMPProperties();</span><br><span class="line">        properties.setProperty(JCSMPProperties.HOST, args[<span class="number">0</span>]);     <span class="comment">// host:port</span></span><br><span class="line">        properties.setProperty(JCSMPProperties.USERNAME, args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">0</span>]); <span class="comment">// client-username</span></span><br><span class="line">        properties.setProperty(JCSMPProperties.VPN_NAME,  args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">1</span>]); <span class="comment">// message-vpn</span></span><br><span class="line">        <span class="keyword">if</span> (args.length &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            properties.setProperty(JCSMPProperties.PASSWORD, args[<span class="number">2</span>]); <span class="comment">// client-password</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> Topic topic = JCSMPFactory.onlyInstance().createTopic(<span class="string">"tutorial/topic"</span>);</span><br><span class="line">        <span class="keyword">final</span> JCSMPSession session = JCSMPFactory.onlyInstance().createSession(properties);</span><br><span class="line"></span><br><span class="line">        session.connect();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> CountDownLatch latch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>); <span class="comment">// used for</span></span><br><span class="line">                                                            <span class="comment">// synchronizing b/w threads</span></span><br><span class="line">        <span class="comment">/** Anonymous inner-class for MessageListener</span></span><br><span class="line"><span class="comment">         *  This demonstrates the async threaded message callback */</span></span><br><span class="line">        <span class="keyword">final</span> XMLMessageConsumer cons = session.getMessageConsumer(<span class="keyword">new</span> XMLMessageListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(BytesXMLMessage msg)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> TextMessage) &#123;</span><br><span class="line">                    System.out.printf(<span class="string">"TextMessage received: '%s'%n"</span>,</span><br><span class="line">                            ((TextMessage)msg).getText());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">"Message received."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.printf(<span class="string">"Message Dump:%n%s%n"</span>,msg.dump());</span><br><span class="line">                latch.countDown();  <span class="comment">// unblock main thread</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onException</span><span class="params">(JCSMPException e)</span> </span>&#123;</span><br><span class="line">                System.out.printf(<span class="string">"Consumer received exception: %s%n"</span>,e);</span><br><span class="line">                latch.countDown();  <span class="comment">// unblock main thread</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        session.addSubscription(topic);</span><br><span class="line">        System.out.println(<span class="string">"Connected. Awaiting message..."</span>);</span><br><span class="line">        cons.start();</span><br><span class="line">        <span class="comment">// Consume-only session is now hooked up and running!</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            latch.await(); <span class="comment">// block here until message received, and latch will flip</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"I was awoken while waiting"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Close consumer</span></span><br><span class="line">        cons.close();</span><br><span class="line">        System.out.println(<span class="string">"Exiting."</span>);</span><br><span class="line">        session.closeSession();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Demo-for-queue"><a href="#Demo-for-queue" class="headerlink" title="Demo for queue"></a>Demo for queue</h2><h3 id="Queue-Producer"><a href="#Queue-Producer" class="headerlink" title="Queue Producer"></a>Queue Producer</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.solace.samples;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.DateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.DeliveryMode;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.EndpointProperties;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.JCSMPException;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.JCSMPFactory;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.JCSMPProperties;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.JCSMPSession;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.JCSMPStreamingPublishEventHandler;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.Queue;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.TextMessage;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.XMLMessageProducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueueProducer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> <span class="keyword">throws</span> JCSMPException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check command line arguments</span></span><br><span class="line">        <span class="keyword">if</span> (args.length &lt; <span class="number">2</span> || args[<span class="number">1</span>].split(<span class="string">"@"</span>).length != <span class="number">2</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Usage: QueueProducer &lt;host:port&gt; &lt;client-username@message-vpn&gt; [client-password]"</span>);</span><br><span class="line">            System.out.println();</span><br><span class="line">            System.exit(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">0</span>].isEmpty()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"No client-username entered"</span>);</span><br><span class="line">            System.out.println();</span><br><span class="line">            System.exit(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">1</span>].isEmpty()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"No message-vpn entered"</span>);</span><br><span class="line">            System.out.println();</span><br><span class="line">            System.exit(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"QueueProducer initializing..."</span>);</span><br><span class="line">        <span class="comment">// Create a JCSMP Session</span></span><br><span class="line">        <span class="keyword">final</span> JCSMPProperties properties = <span class="keyword">new</span> JCSMPProperties();</span><br><span class="line">        properties.setProperty(JCSMPProperties.HOST, args[<span class="number">0</span>]);     <span class="comment">// host:port</span></span><br><span class="line">        properties.setProperty(JCSMPProperties.USERNAME, args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">0</span>]); <span class="comment">// client-username</span></span><br><span class="line">        properties.setProperty(JCSMPProperties.VPN_NAME,  args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">1</span>]); <span class="comment">// message-vpn</span></span><br><span class="line">        <span class="keyword">if</span> (args.length &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            properties.setProperty(JCSMPProperties.PASSWORD, args[<span class="number">2</span>]); <span class="comment">// client-password</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> JCSMPSession session = JCSMPFactory.onlyInstance().createSession(properties);</span><br><span class="line"></span><br><span class="line">        session.connect();</span><br><span class="line"></span><br><span class="line">        String queueName = <span class="string">"Q/tutorial"</span>;</span><br><span class="line">        System.out.printf(<span class="string">"Attempting to provision the queue '%s' on the appliance.%n"</span>, queueName);</span><br><span class="line">        <span class="keyword">final</span> EndpointProperties endpointProps = <span class="keyword">new</span> EndpointProperties();</span><br><span class="line">        <span class="comment">// set queue permissions to "consume" and access-type to "exclusive"</span></span><br><span class="line">        endpointProps.setPermission(EndpointProperties.PERMISSION_CONSUME);</span><br><span class="line">        endpointProps.setAccessType(EndpointProperties.ACCESSTYPE_EXCLUSIVE);</span><br><span class="line">        <span class="comment">// create the queue object locally</span></span><br><span class="line">        <span class="keyword">final</span> Queue queue = JCSMPFactory.onlyInstance().createQueue(queueName);</span><br><span class="line">        <span class="comment">// Actually provision it, and do not fail if it already exists</span></span><br><span class="line">        session.provision(queue, endpointProps, JCSMPSession.FLAG_IGNORE_ALREADY_EXISTS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Anonymous inner-class for handling publishing events */</span></span><br><span class="line">        <span class="keyword">final</span> XMLMessageProducer prod = session.getMessageProducer(</span><br><span class="line">                <span class="keyword">new</span> JCSMPStreamingPublishEventHandler() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">responseReceived</span><span class="params">(String messageID)</span> </span>&#123;</span><br><span class="line">                        System.out.printf(<span class="string">"Producer received response for msg ID #%s%n"</span>,messageID);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleError</span><span class="params">(String messageID, JCSMPException e, <span class="keyword">long</span> timestamp)</span> </span>&#123;</span><br><span class="line">                        System.out.printf(<span class="string">"Producer received error for msg ID %s @ %s - %s%n"</span>,</span><br><span class="line">                                messageID,timestamp,e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Publish-only session is now hooked up and running!</span></span><br><span class="line">        System.out.printf(<span class="string">"Connected. About to send message to queue '%s'...%n"</span>,queue.getName());</span><br><span class="line"></span><br><span class="line">        TextMessage msg = JCSMPFactory.onlyInstance().createMessage(TextMessage<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        msg.setDeliveryMode(DeliveryMode.PERSISTENT);</span><br><span class="line">        String text = <span class="string">"Persistent Queue Tutorial! "</span>+DateFormat.getDateTimeInstance().format(<span class="keyword">new</span> Date());</span><br><span class="line">        msg.setText(text);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Send message directly to the queue</span></span><br><span class="line">        prod.send(msg, queue);</span><br><span class="line">	<span class="comment">// Delivery not yet confirmed. See ConfirmedPublish.java</span></span><br><span class="line">        System.out.println(<span class="string">"Message sent. Exiting."</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Close session</span></span><br><span class="line">        session.closeSession();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Queue-Consumer"><a href="#Queue-Consumer" class="headerlink" title="Queue Consumer"></a>Queue Consumer</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.solace.samples;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.BytesXMLMessage;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.ConsumerFlowProperties;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.EndpointProperties;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.FlowReceiver;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.JCSMPException;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.JCSMPFactory;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.JCSMPProperties;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.JCSMPSession;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.Queue;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.TextMessage;</span><br><span class="line"><span class="keyword">import</span> com.solacesystems.jcsmp.XMLMessageListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueueConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> <span class="keyword">throws</span> JCSMPException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// Check command line arguments</span></span><br><span class="line">        <span class="keyword">if</span> (args.length &lt; <span class="number">2</span> || args[<span class="number">1</span>].split(<span class="string">"@"</span>).length != <span class="number">2</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Usage: QueueConsumer &lt;host:port&gt; &lt;client-username@message-vpn&gt; [client-password]"</span>);</span><br><span class="line">            System.out.println();</span><br><span class="line">            System.exit(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">0</span>].isEmpty()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"No client-username entered"</span>);</span><br><span class="line">            System.out.println();</span><br><span class="line">            System.exit(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">1</span>].isEmpty()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"No message-vpn entered"</span>);</span><br><span class="line">            System.out.println();</span><br><span class="line">            System.exit(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"QueueConsumer initializing..."</span>);</span><br><span class="line">        <span class="comment">// Create a JCSMP Session</span></span><br><span class="line">        <span class="keyword">final</span> JCSMPProperties properties = <span class="keyword">new</span> JCSMPProperties();</span><br><span class="line">        properties.setProperty(JCSMPProperties.HOST, args[<span class="number">0</span>]);     <span class="comment">// host:port</span></span><br><span class="line">        properties.setProperty(JCSMPProperties.USERNAME, args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">0</span>]); <span class="comment">// client-username</span></span><br><span class="line">        properties.setProperty(JCSMPProperties.VPN_NAME,  args[<span class="number">1</span>].split(<span class="string">"@"</span>)[<span class="number">1</span>]); <span class="comment">// message-vpn</span></span><br><span class="line">        <span class="keyword">if</span> (args.length &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            properties.setProperty(JCSMPProperties.PASSWORD, args[<span class="number">2</span>]); <span class="comment">// client-password</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> JCSMPSession session = JCSMPFactory.onlyInstance().createSession(properties);</span><br><span class="line">        session.connect();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> String queueName = <span class="string">"Q/tutorial"</span>;</span><br><span class="line">        System.out.printf(<span class="string">"Attempting to provision the queue '%s' on the appliance.%n"</span>, queueName);</span><br><span class="line">        <span class="keyword">final</span> EndpointProperties endpointProps = <span class="keyword">new</span> EndpointProperties();</span><br><span class="line">        <span class="comment">// set queue permissions to "consume" and access-type to "exclusive"</span></span><br><span class="line">        endpointProps.setPermission(EndpointProperties.PERMISSION_CONSUME);</span><br><span class="line">        endpointProps.setAccessType(EndpointProperties.ACCESSTYPE_EXCLUSIVE);</span><br><span class="line">        <span class="comment">// create the queue object locally</span></span><br><span class="line">        <span class="keyword">final</span> Queue queue = JCSMPFactory.onlyInstance().createQueue(queueName);</span><br><span class="line">        <span class="comment">// Actually provision it, and do not fail if it already exists</span></span><br><span class="line">        session.provision(queue, endpointProps, JCSMPSession.FLAG_IGNORE_ALREADY_EXISTS);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> CountDownLatch latch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>); <span class="comment">// used for synchronizing b/w threads</span></span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">"Attempting to bind to the queue '%s' on the appliance.%n"</span>, queueName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a Flow be able to bind to and consume messages from the Queue.</span></span><br><span class="line">        <span class="keyword">final</span> ConsumerFlowProperties flow_prop = <span class="keyword">new</span> ConsumerFlowProperties();</span><br><span class="line">        flow_prop.setEndpoint(queue);</span><br><span class="line">        flow_prop.setAckMode(JCSMPProperties.SUPPORTED_MESSAGE_ACK_CLIENT);</span><br><span class="line"></span><br><span class="line">        EndpointProperties endpoint_props = <span class="keyword">new</span> EndpointProperties();</span><br><span class="line">        endpoint_props.setAccessType(EndpointProperties.ACCESSTYPE_EXCLUSIVE);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> FlowReceiver cons = session.createFlow(<span class="keyword">new</span> XMLMessageListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(BytesXMLMessage msg)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> TextMessage) &#123;</span><br><span class="line">                    System.out.printf(<span class="string">"TextMessage received: '%s'%n"</span>, ((TextMessage) msg).getText());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">"Message received."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.printf(<span class="string">"Message Dump:%n%s%n"</span>, msg.dump());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// When the ack mode is set to SUPPORTED_MESSAGE_ACK_CLIENT,</span></span><br><span class="line">                <span class="comment">// guaranteed delivery messages are acknowledged after</span></span><br><span class="line">                <span class="comment">// processing</span></span><br><span class="line">                msg.ackMessage();</span><br><span class="line">                latch.countDown(); <span class="comment">// unblock main thread</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onException</span><span class="params">(JCSMPException e)</span> </span>&#123;</span><br><span class="line">                System.out.printf(<span class="string">"Consumer received exception: %s%n"</span>, e);</span><br><span class="line">                latch.countDown(); <span class="comment">// unblock main thread</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, flow_prop, endpoint_props);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Start the consumer</span></span><br><span class="line">        System.out.println(<span class="string">"Connected. Awaiting message ..."</span>);</span><br><span class="line">        cons.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            latch.await(); <span class="comment">// block here until message received, and latch will flip</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"I was awoken while waiting"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Close consumer</span></span><br><span class="line">        cons.close();</span><br><span class="line">        System.out.println(<span class="string">"Exiting."</span>);</span><br><span class="line">        session.closeSession();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Demo-for-Topic-to-queue"><a href="#Demo-for-Topic-to-queue" class="headerlink" title="Demo for Topic to queue"></a>Demo for Topic to queue</h2><p>TBC..</p>

      </div>
      
      <footer class="post-footer">
        
        <nav class="post-nav"><a class="prev" href="/2020/01/16/Quick-install-ForgeRock-OpenAM/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Quick install ForgeRock OpenAM in local env</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    <a class="next" href="/2019/11/18/Email-Integration-in-Spring-Boot-with-a-fake-SMTP-service-Ethereal/">
        <span class="next-text nav-default">Email Integration in Spring Boot with a fake SMTP service -- Ethereal</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"></div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"></div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even" target="_blank" rel="noopener">Even</a>
  </span>

  <span class="copyright-year">&copy;2015 - 2020<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Dzivet</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
